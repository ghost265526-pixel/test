<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WalletConnect V2 - No QR Code</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: system-ui, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .container { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(20px); border-radius: 24px; padding: 48px; text-align: center; max-width: 500px; width: 100%; border: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); }
        .logo { font-size: 64px; margin-bottom: 16px; }
        h1 { color: white; font-size: 32px; margin-bottom: 12px; font-weight: 700; }
        .subtitle { color: rgba(255, 255, 255, 0.8); margin-bottom: 32px; font-size: 16px; }
        .btn { background: white; color: #667eea; border: none; padding: 16px 48px; border-radius: 12px; font-size: 18px; font-weight: 600; cursor: pointer; transition: all 0.3s; width: 100%; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); }
        .btn:hover { transform: translateY(-2px); }
        .btn-disconnect { background: #ff4444; color: white; margin-top: 16px; }
        .info-box { margin-top: 16px; padding: 16px; border-radius: 12px; background: rgba(255, 255, 255, 0.1); display: none; color: white; word-break: break-all; font-size: 14px; }
        .info-box.show { display: block; }
        .status { margin-top: 12px; color: rgba(255, 255, 255, 0.8); font-size: 14px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">üîê</div>
        <h1>WalletConnect V2</h1>
        <p class="subtitle">Mobile Deep Linking - No QR Code</p>
        
        <button id="connectBtn" class="btn">Connect Wallet</button>
        <button id="disconnectBtn" class="btn btn-disconnect" style="display:none;">Disconnect</button>
        
        <div id="status" class="status"></div>
        <div id="accountBox" class="info-box"></div>
        <div id="chainBox" class="info-box"></div>
    </div>

    <script type="module">
        import { EthereumProvider } from "https://cdn.jsdelivr.net/npm/@walletconnect/ethereum-provider@2.11.0/+esm";
        import { Web3Modal } from "https://cdn.jsdelivr.net/npm/@web3modal/standalone@2.4.3/+esm";

        // ===== CONFIGURATION AVEC VOTRE PROJECT ID =====
        const CONFIG = {
            projectId: '72f0728c47e59d2eb9fc83069bc6843d', // ‚úÖ VOTRE PROJECT ID
            chains: [1, 137, 56], // Ethereum, Polygon, BSC
            optionalChains: [42161, 10, 43114] // Arbitrum, Optimism, Avalanche
        };

        let provider, web3Modal, accounts = [], chainId = null;

        // ===== INITIALISATION =====
        async function init() {
            try {
                console.log('üöÄ Initializing WalletConnect V2...');
                setStatus('Initializing...');

                // Cr√©er Web3Modal (liste des wallets)
                web3Modal = new Web3Modal({
                    projectId: CONFIG.projectId,
                    standaloneChains: ['eip155:1'],
                    walletConnectVersion: 2,
                    enableExplorer: true,
                    explorerRecommendedWalletIds: [
                        'c57ca95b47569778a828d19178114f4db188b89b763c899ba0be274e97267d96', // MetaMask
                        '4622a2b2d6af1c9844944291e5e7351a6aa24cd7b23099efac1b2fd875da31a0', // Trust Wallet
                        '1ae92b26df02f0abca6304df07debccd18262fdf5fe82daa81593582dac9a369', // Rainbow
                        'fd20dc426fb37566d803205b19bbc1d4096b248ac04548e3cfb6b3a38bd033aa', // Coinbase
                    ]
                });

                // Cr√©er Provider (sans QR code)
                provider = await EthereumProvider.init({
                    projectId: CONFIG.projectId,
                    chains: CONFIG.chains,
                    optionalChains: CONFIG.optionalChains,
                    showQrModal: false, // üö´ D√âSACTIVE LE QR CODE
                    methods: ['eth_sendTransaction', 'personal_sign', 'eth_signTypedData'],
                    events: ['chainChanged', 'accountsChanged'],
                    metadata: {
                        name: 'My DApp',
                        description: 'Connect your wallet',
                        url: window.location.origin,
                        icons: ['https://avatars.githubusercontent.com/u/37784886']
                    }
                });

                setupEvents();
                console.log('‚úÖ Initialization complete!');
                setStatus('Ready to connect');

            } catch (error) {
                console.error('‚ùå Init error:', error);
                setStatus('‚ùå Initialization failed');
                alert('Initialization failed: ' + error.message);
            }
        }

        // ===== √âV√âNEMENTS =====
        function setupEvents() {
            // Quand URI est g√©n√©r√©, ouvrir le modal avec liste de wallets
            provider.on('display_uri', (uri) => {
                console.log('üì± Display URI event - Opening wallet list...');
                setStatus('Opening wallet list...');
                web3Modal.openModal({ 
                    uri, 
                    standaloneChains: ['eip155:1']
                });
            });

            // Connexion r√©ussie
            provider.on('connect', (data) => {
                console.log('‚úÖ Connected!', data);
                accounts = provider.accounts || [];
                chainId = provider.chainId;
                web3Modal.closeModal();
                setStatus('‚úÖ Connected successfully!');
                updateUI(true);
            });

            // D√©connexion
            provider.on('disconnect', () => {
                console.log('‚ùå Disconnected');
                accounts = [];
                chainId = null;
                setStatus('Disconnected');
                updateUI(false);
            });

            // Changement de compte
            provider.on('accountsChanged', (newAccounts) => {
                console.log('üë§ Accounts changed:', newAccounts);
                accounts = newAccounts;
                updateUI(true);
            });

            // Changement de cha√Æne
            provider.on('chainChanged', (newChainId) => {
                console.log('üîó Chain changed:', newChainId);
                chainId = newChainId;
                updateChainUI();
            });
        }

        // ===== STATUS =====
        function setStatus(message) {
            document.getElementById('status').textContent = message;
        }

        // ===== MISE √Ä JOUR UI =====
        function updateUI(connected) {
            const connectBtn = document.getElementById('connectBtn');
            const disconnectBtn = document.getElementById('disconnectBtn');
            const accountBox = document.getElementById('accountBox');

            if (connected && accounts.length > 0) {
                connectBtn.style.display = 'none';
                disconnectBtn.style.display = 'block';
                accountBox.innerHTML = '<strong>Connected Account:</strong><br>' + accounts[0];
                accountBox.classList.add('show');
                updateChainUI();
            } else {
                connectBtn.style.display = 'block';
                disconnectBtn.style.display = 'none';
                accountBox.classList.remove('show');
                document.getElementById('chainBox').classList.remove('show');
            }
        }

        function updateChainUI() {
            const chainBox = document.getElementById('chainBox');
            if (chainId) {
                const chainNames = { 
                    1: 'Ethereum Mainnet', 
                    137: 'Polygon', 
                    56: 'BSC', 
                    42161: 'Arbitrum', 
                    10: 'Optimism', 
                    43114: 'Avalanche' 
                };
                chainBox.innerHTML = '<strong>Network:</strong><br>' + (chainNames[chainId] || 'Chain ID: ' + chainId);
                chainBox.classList.add('show');
            }
        }

        // ===== CONNEXION / D√âCONNEXION =====
        async function connect() {
            try {
                console.log('üîå Connecting...');
                setStatus('Connecting...');
                
                await provider.connect({
                    chains: CONFIG.chains,
                    optionalChains: CONFIG.optionalChains
                });
                
            } catch (error) {
                console.error('‚ùå Connection error:', error);
                setStatus('‚ùå Connection failed');
                
                if (error.message.includes('User rejected')) {
                    alert('Connection rejected by user');
                } else {
                    alert('Connection failed: ' + error.message);
                }
            }
        }

        async function disconnect() {
            try {
                console.log('üîå Disconnecting...');
                setStatus('Disconnecting...');
                await provider.disconnect();
                setStatus('Disconnected');
            } catch (error) {
                console.error('‚ùå Disconnect error:', error);
                setStatus('‚ùå Disconnect failed');
            }
        }

        // ===== BOUTONS =====
        document.getElementById('connectBtn').addEventListener('click', connect);
        document.getElementById('disconnectBtn').addEventListener('click', disconnect);

        // ===== D√âMARRAGE =====
        window.addEventListener('DOMContentLoaded', async () => {
            console.log('üåê Page loaded - Starting initialization...');
            await init();
            
            // Restaurer session si elle existe
            if (provider && provider.session) {
                console.log('üîÑ Restoring previous session...');
                accounts = provider.accounts || [];
                chainId = provider.chainId;
                if (accounts.length > 0) {
                    setStatus('Session restored');
                    updateUI(true);
                }
            }
        });

        // ===== EXPORTS GLOBAUX =====
        window.walletConnect = {
            getProvider: () => provider,
            getAccounts: () => accounts,
            getChainId: () => chainId,
            isConnected: () => accounts.length > 0,
            connect,
            disconnect,
            
            // Envoyer une transaction
            sendTransaction: async (tx) => {
                if (!provider || accounts.length === 0) {
                    throw new Error('Not connected');
                }
                return await provider.request({
                    method: 'eth_sendTransaction',
                    params: [{ ...tx, from: accounts[0] }]
                });
            },
            
            // Signer un message
            signMessage: async (message) => {
                if (!provider || accounts.length === 0) {
                    throw new Error('Not connected');
                }
                return await provider.request({
                    method: 'personal_sign',
                    params: [message, accounts[0]]
                });
            }
        };

        console.log('üí° Use window.walletConnect to interact with the provider');
    </script>
</body>
</html>
